<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2026-02-24 Tue 17:26 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parallel Computing with MATLAB on TRUBA HPC</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="sbilmis" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Parallel Computing with MATLAB on TRUBA HPC</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc37acad">1. Introduction</a>
<ul>
<li><a href="#org0ab8607">1.1. Why use TRUBA for MATLAB?</a></li>
<li><a href="#orgb91b975">1.2. Tested Environment</a></li>
</ul>
</li>
<li><a href="#orgd256072">2. Prerequisites &amp; Licensing</a>
<ul>
<li><a href="#org03b7c4c">2.1. Licensing and Policy</a></li>
<li><a href="#orga41a3da">2.2. What this means in practice</a></li>
</ul>
</li>
<li><a href="#org1c4f222">3. Configuring MATLAB to Run on the HPC Cluster (Web Browser via Open OnDemand)</a>
<ul>
<li><a href="#orgb3e6a97">3.1. Accessing the ARF Cluster</a></li>
<li><a href="#org2b73a3d">3.2. Starting MATLAB in the Desktop Session</a></li>
<li><a href="#org91a43aa">3.3. Introducing MATLAB to the Cluster</a></li>
<li><a href="#org9ded67c">3.4. Important: The "Validate" Button</a></li>
<li><a href="#orgbbf712f">3.5. Switching Between ARF and CUDA Clusters</a></li>
</ul>
</li>
<li><a href="#orgd45a62e">4. Configuring MATLAB to Submit Jobs from Local MATLAB to TRUBA</a>
<ul>
<li><a href="#org505a528">4.1. Verify Your User Path</a></li>
<li><a href="#orga65c415">4.2. Install the TRUBA Cluster Plugin</a></li>
<li><a href="#org24ec2e5">4.3. Switching Between Your Computer and the Cluster</a>
<ul>
<li><a href="#org4843764">4.3.1. Setting Up Your Local Profile</a></li>
<li><a href="#org79d4ff3">4.3.2. How to Switch Profiles in Your Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga052ce1">5. Configuring Jobs (Scheduler Parameters (Slurm Options))</a>
<ul>
<li><a href="#org6e1a0cf">5.1. Understanding Slurm: The Cluster "Booking System"</a>
<ul>
<li><a href="#orgff03b43">5.1.1. Listing Available Partitions from MATLAB</a></li>
</ul>
</li>
<li><a href="#orge8aa4f7">5.2. Slurm Options Exposed by the TRUBA MATLAB Profile</a></li>
<li><a href="#orge9c243c">5.3. What You Typically Need to Specify</a></li>
<li><a href="#org1c982d1">5.4. Your First "Hello World Job"  (Recommended)</a>
<ul>
<li><a href="#orgfbec78e">5.4.1. Understanding the <code>batch</code> Command</a></li>
</ul>
</li>
<li><a href="#orgd75dba5">5.5. The "Pool + 1" Rule: How Cores are Counted</a>
<ul>
<li><a href="#org3541446">5.5.1. Why does this matter?</a></li>
</ul>
</li>
<li><a href="#org7d0135c">5.6. Partition Policies on TRUBA</a>
<ul>
<li><a href="#org292a5d7">5.6.1. Summary of node sizes (informative)</a></li>
<li><a href="#orgb296ded">5.6.2. CPU partitions: per-node CPU count rules</a></li>
<li><a href="#orgc27cc49">5.6.3. GPU partitions: GPU request and CPU↔GPU ratio rules</a></li>
<li><a href="#org472d986">5.6.4. Working directory policy</a></li>
</ul>
</li>
<li><a href="#org9e3bd25">5.7. CPU and Memory Relationship (Conceptual Model)</a>
<ul>
<li><a href="#org6da566a">5.7.1. Important: Responsible Resource Usage</a></li>
</ul>
</li>
<li><a href="#orgda56a53">5.8. Resource Selection Strategy</a>
<ul>
<li><a href="#orgdfc17f9">5.8.1. CPU-bound Jobs</a></li>
<li><a href="#org2c57a82">5.8.2. Memory-bound Jobs</a></li>
<li><a href="#org1da16a3">5.8.3. GPU-bound Jobs</a></li>
</ul>
</li>
<li><a href="#org2cfe416">5.9. Monitoring the Job</a>
<ul>
<li><a href="#org7d520d4">5.9.1. From MATLAB</a></li>
<li><a href="#org5c26fb2">5.9.2. From the TRUBA Login Node (Slurm)</a></li>
</ul>
</li>
<li><a href="#org53cdab8">5.10. Fetching and Inspecting Job Results</a>
<ul>
<li><a href="#org8a03302">5.10.1. Fetch outputs</a></li>
<li><a href="#org0f05b42">5.10.2. If the job failed</a></li>
<li><a href="#orgd10447f">5.10.3. Working with multiple test jobs</a></li>
<li><a href="#org875d470">5.10.4. Optional cleanup</a></li>
<li><a href="#orgd1885da">5.10.5. Deleting All Jobs from the Profile</a></li>
</ul>
</li>
<li><a href="#org0efea9c">5.11. Modifying or Unsetting Settings</a></li>
<li><a href="#orgdebe50a">5.12. Saving Settings</a></li>
</ul>
</li>
<li><a href="#org625caf1">6. Advanced: Interactive Parallel Jobs from MATLAB on the Desktop</a>
<ul>
<li><a href="#org8fb94cc">6.1. Interactive Parallel Work</a></li>
<li><a href="#org0567e6d">6.2. Closing the Pool</a></li>
<li><a href="#org3beb6a2">6.3. TRUBA Resource Constraints (Important)</a></li>
<li><a href="#orgf4e896f">6.4. Opening Job Monitor</a></li>
<li><a href="#org1d02f76">6.5. Example: Job Monitor Window</a></li>
</ul>
</li>
<li><a href="#org4dac4b1">7. TRUBA MATLAB Helper Functions</a></li>
<li><a href="#orgd827cfa">8. Troubleshooting and Debugging</a>
<ul>
<li><a href="#orga9d529e">8.1. Licensing Issues</a>
<ul>
<li><a href="#orgdecba72">8.1.1. Check license availability (local MATLAB)</a></li>
<li><a href="#orgf3790b6">8.1.2. Check license status on TRUBA (if permitted)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org861004b">9. EXAMPLES (Cheatsheet)</a>
<ul>
<li><a href="#org5e89c0e">9.1. What Happens After You Submit a Job?</a>
<ul>
<li><a href="#org566ae5e">9.1.1. You Can Close MATLAB</a></li>
</ul>
</li>
<li><a href="#orgc2a62c6">9.2. Example: Running on the <code>orfoz</code> Partition (56-core half-node)</a>
<ul>
<li><a href="#org55579de">9.2.1. Correct example (half node on <code>orfoz</code>)</a></li>
<li><a href="#org8ed2f57">9.2.2. Common mistake (will be rejected)</a></li>
<li><a href="#org6723dc0">9.2.3. Slurm Command Generated by MATLAB</a></li>
</ul>
</li>
<li><a href="#org268251f">9.3. Example: Submitting a GPU Job (<code>barbun-cuda</code>)</a>
<ul>
<li><a href="#orged320c6">9.3.1. Key policy on <code>barbun-cuda</code></a></li>
<li><a href="#orgcef1bfe">9.3.2. Hardware note</a></li>
<li><a href="#org915518e">9.3.3. Minimal valid GPU test job (2 GPUs, 40 CPUs on 1 node)</a></li>
<li><a href="#org039665b">9.3.4. Slurm command generated by MATLAB</a></li>
<li><a href="#orgaaf6dd0">9.3.5. Common mistakes (and what happens)</a></li>
<li><a href="#org8c0a8f7">9.3.6. Tips</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org036fc34">10. A parfor Example (Four Execution Methods)</a>
<ul>
<li><a href="#org0b53745">10.1. Why Parallelization Matters</a></li>
<li><a href="#org8b2e8c4">10.2. Submitting from a Local MATLAB Session (Cluster Profile)</a>
<ul>
<li><a href="#orgd3deb09">10.2.1. File Location and Execution Model</a></li>
<li><a href="#orgc5e8698">10.2.2. Cluster Configuration</a></li>
<li><a href="#org8281c91">10.2.3. Job Submission</a></li>
<li><a href="#org0ac3c1e">10.2.4. Job Submission (File Already Exists on TRUBA)</a></li>
<li><a href="#org3ef7421">10.2.5. Retrieve Output</a></li>
<li><a href="#org3312d4d">10.2.6. Job Submission (File Already Exists on TRUBA)</a></li>
</ul>
</li>
<li><a href="#orgaadc2d9">10.3. Running Interactively on TRUBA with <code>parpool</code></a>
<ul>
<li><a href="#org56db246">10.3.1. Set the client hostname (recommended)</a></li>
<li><a href="#org20b03c2">10.3.2. Create the cluster pool</a></li>
<li><a href="#orgefb72a3">10.3.3. Run the demo code</a></li>
<li><a href="#orgf35c48a">10.3.4. Close the pool (release resources)</a></li>
</ul>
</li>
<li><a href="#orga0cae25">10.4. Submitting via a Slurm Batch Script (Recommended HPC Method)</a>
<ul>
<li><a href="#org35348e6">10.4.1. MATLAB Script (run_parfor.m)</a></li>
<li><a href="#org258aea3">10.4.2. Slurm Script (submit_parfor.sh)</a></li>
<li><a href="#org0c36d59">10.4.3. Submitting the Job</a></li>
<li><a href="#org3065025">10.4.4. Output File</a></li>
</ul>
</li>
<li><a href="#orga99d75d">10.5. Running MATLAB via Open OnDemand (Interactive Desktop)</a>
<ul>
<li><a href="#orgb8fddc0">10.5.1. Step 1: Launch Desktop Session</a></li>
<li><a href="#orge7ed6da">10.5.2. Step 2: Open Terminal</a></li>
<li><a href="#org6149c54">10.5.3. Step 3: Load MATLAB Module</a></li>
<li><a href="#orgadd8c84">10.5.4. Step 4: Submit Job Using batch()</a></li>
<li><a href="#org9bf1f2b">10.5.5. Step 5: Close MATLAB (Optional)</a></li>
<li><a href="#orge9fc87f">10.5.6. Step 6: Monitor Job from Terminal</a></li>
<li><a href="#orgc5df7a1">10.5.7. Step 7: Retrieve Output Without MATLAB</a></li>
<li><a href="#org00c92be">10.5.8. Step 8: (Optional) Retrieve Output Later in MATLAB</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8eb49a6">11. Further Reading</a></li>
</ul>
</div>
</div>



<div id="outline-container-orgc37acad" class="outline-2">
<h2 id="orgc37acad"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This document describes the configuration and usage of MATLAB on the TRUBA (HPC) infrastructure, including license usage,
interactive execution, and batch job submission via Slurm.
</p>

<p>
This guide is intended for academic users of TRUBA.
</p>
</div>

<div id="outline-container-org0ab8607" class="outline-3">
<h3 id="org0ab8607"><span class="section-number-3">1.1.</span> Why use TRUBA for MATLAB?</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><b><b>Speed:</b></b> Run heavy simulations faster using high-end CPUs.</li>
<li><b><b>Memory:</b></b> Handle much larger datasets than a standard laptop can manage.</li>
<li><b><b>Parallel Computing:</b></b> Run multiple MATLAB "workers" simultaneously to solve problems in a fraction of the time.</li>
</ul>
</div>
</div>



<div id="outline-container-orgb91b975" class="outline-3">
<h3 id="orgb91b975"><span class="section-number-3">1.2.</span> Tested Environment</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<b>Note:</b> This documentation was validated under the following environment. Changes in MATLAB versions or Slurm settings may require minor adjustments.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Component</th>
<th scope="col" class="org-left">Version / Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Cluster</td>
<td class="org-left">TRUBA (arf and cuda)</td>
</tr>

<tr>
<td class="org-left">Partitions Tested</td>
<td class="org-left">debug</td>
</tr>

<tr>
<td class="org-left">MATLAB</td>
<td class="org-left">R2025b</td>
</tr>

<tr>
<td class="org-left">License Model</td>
<td class="org-left">Network Academic (MathWorks)</td>
</tr>

<tr>
<td class="org-left">Slurm</td>
<td class="org-left">23.02.5-1</td>
</tr>

<tr>
<td class="org-left">OS</td>
<td class="org-left">Rocky Linux 9</td>
</tr>

<tr>
<td class="org-left">Test Date</td>
<td class="org-left">2026-02-18</td>
</tr>
</tbody>
</table>


<p>
This guide reflects the configuration of TRUBA as of the test date above.
Changes in MATLAB versions, Slurm configuration, or license settings may
require adjustments.
</p>
</div>
</div>
</div>


<div id="outline-container-orgd256072" class="outline-2">
<h2 id="orgd256072"><span class="section-number-2">2.</span> Prerequisites &amp; Licensing</h2>
<div class="outline-text-2" id="text-2">
<p>
Ensure you have these three requirements ready before proceeding:
</p>
<ul class="org-ul">
<li><b><b>Active TRUBA Account:</b></b> A valid username and password.</li>
<li><b><b>VPN Connection:</b></b> <b><b>OpenVPN</b></b> must be active to access the cluster.</li>
<li><b><b>Academic Purpose:</b></b> MATLAB on TRUBA is strictly for academic research. Commercial/corporate use is not permitted.</li>
</ul>
</div>


<div id="outline-container-org03b7c4c" class="outline-3">
<h3 id="org03b7c4c"><span class="section-number-3">2.1.</span> Licensing and Policy</h3>
<div class="outline-text-3" id="text-2-1">
<p>
TRUBA provides MATLAB under a sponsored <b>Network Academic</b> license. 
</p>

<div class="IMPORTANT" id="orgee2cf0c">
<p>
<b><b>Important:</b></b> Only <b>academic</b> MATLAB usage is permitted on TRUBA compute resources. 
</p>

</div>
</div>
</div>


<div id="outline-container-orga41a3da" class="outline-3">
<h3 id="orga41a3da"><span class="section-number-3">2.2.</span> What this means in practice</h3>
<div class="outline-text-3" id="text-2-2">
<p>
How the license is handled depends on how you choose to work:
</p>

<ul class="org-ul">
<li><b><b>Using Open OnDemand or Batch Mode:</b></b> If you run MATLAB directly on the TRUBA cluster (via your web browser or a batch script), the license is provided and managed automatically on the cluster side. You do not need to provide your own.</li>
<li><b><b>Using MATLAB on your Personal Computer:</b></b> If you write code in your local MATLAB and submit jobs to TRUBA using the cluster plugin, your local installation <b><b>must</b></b> be an <b>academic</b> license. If you use a commercial or trial license on your laptop, the remote execution will be blocked.</li>
</ul>

<div class="TIP" id="orgd001e76">
<p>
<b>Not sure if your license is Academic?</b>
Open MATLAB on your computer and type <code>license</code> in the Command Window. If you are still unsure, contact your university’s software coordinator or IT department.
</p>

</div>
</div>
</div>
</div>



<div id="outline-container-org1c4f222" class="outline-2">
<h2 id="org1c4f222"><span class="section-number-2">3.</span> Configuring MATLAB to Run on the HPC Cluster (Web Browser via Open OnDemand)</h2>
<div class="outline-text-2" id="text-3">
<p>
This method allows you to use a full graphical MATLAB interface directly in your web browser (Open OnDemand). It is the best choice if you want to work interactively.
</p>

<div class="IMPORTANT" id="org06c8521">
<p>
<b><b>Rule:</b></b> You must launch MATLAB through Open OnDemand. Running MATLAB directly on "login nodes" is strictly prohibited and will be terminated.
</p>

</div>
</div>

<div id="outline-container-orgb3e6a97" class="outline-3">
<h3 id="orgb3e6a97"><span class="section-number-3">3.1.</span> Accessing the ARF Cluster</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Connect to <b><b>TRUBA OpenVPN</b></b>.</li>
<li>Open your browser and go to: <a href="https://172.16.6.20">https://172.16.6.20</a></li>
<li>Log in with your TRUBA username and password.</li>
<li>From the dashboard, click on <b><b>Interactive Apps</b></b> and select <b><b>Desktop</b></b>.</li>
</ul>

<p>
For detailed connection instructions on OpenOnDemand usage on TRUBA, refer to:
<a href="https://docs.truba.gov.tr">https://docs.truba.gov.tr</a>
</p>


<div id="org35df426" class="figure">
<p><img src="images/arf_ood_dashboard.png" alt="arf_ood_dashboard.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Open OnDemand dashboard for ARF cluster</p>
</div>
</div>
</div>


<div id="outline-container-org2b73a3d" class="outline-3">
<h3 id="org2b73a3d"><span class="section-number-3">3.2.</span> Starting MATLAB in the Desktop Session</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Once your virtual desktop appears in the browser:
</p>

<ul class="org-ul">
<li><b><b>Open a Terminal:</b></b> Right-click anywhere on the desktop and select <b>Open Terminal Here</b>.</li>
</ul>


<ul class="org-ul">
<li><b><b>Load MATLAB:</b></b> Type the following commands to prepare the environment (we use the latest version by default):</li>
</ul>

<div class="org-src-container">
<pre class="src src-bash">module purge
module available | grep -i matlab <span style="color: #8D8D84;"># </span><span style="color: #A0A1A7; font-style: italic;">to see the available modules installed (we generally keep the latest 4 version of the MATLAB on the cluster</span>
module load apps/matlab/r2025b
</pre>
</div>

<ul class="org-ul">
<li><b><b>Launch MATLAB:</b></b> Run the command below. We add <code>-nosplash</code> to make it open faster and remove the startup splash screen.</li>
</ul>

<div class="org-src-container">
<pre class="src src-bash">matlab -nosplash
</pre>
</div>
</div>
</div>



<div id="outline-container-org91a43aa" class="outline-3">
<h3 id="org91a43aa"><span class="section-number-3">3.3.</span> Introducing MATLAB to the Cluster</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Even though you are on the cluster, MATLAB needs to "discover" its surroundings the first time you run it.
</p>

<ol class="org-ol">
<li>In the MATLAB <b><b>Home</b></b> tab, click <b><b>Parallel</b></b> -&gt; <b><b>Discover Clusters…</b></b></li>
<li>MATLAB will detect the specific compute node you were assigned (e.g., <code>orfoz34</code>).</li>
<li>Follow the prompts to finish.</li>
</ol>



<div id="org74fea5a" class="figure">
<p><img src="images/matlab_discover_clusters.png" alt="matlab_discover_clusters.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Discover Clusters window showing allocated compute node</p>
</div>


<div class="NOTE" id="org60d63c9">
<p>
<b><b>What does this step do?</b></b> This simply tells MATLAB that it is running on a TRUBA compute node. It does <b>not</b> set up long-term job submission (we will do that in the next section).
</p>

</div>
</div>
</div>



<div id="outline-container-org9ded67c" class="outline-3">
<h3 id="org9ded67c"><span class="section-number-3">3.4.</span> Important: The "Validate" Button</h3>
<div class="outline-text-3" id="text-3-4">
<p>
If you open the <b>Cluster Profile Manager</b> (Home → Parallel → Cluster Profile Manager), you will see a <b><b>Validate</b></b> button. 
</p>

<div class="IMPORTANT" id="org0ff7b7c">
<p>
<b><b>Do not use the "Validate" button here.</b></b> On TRUBA, job execution is handled by the Slurm manager, not MATLAB's internal validator. The validation test will likely fail, but this <b><b>does not</b></b> mean your MATLAB is broken. As long as you can run commands, your setup is correct.
</p>

</div>
</div>
</div>



<div id="outline-container-orgbbf712f" class="outline-3">
<h3 id="orgbbf712f"><span class="section-number-3">3.5.</span> Switching Between ARF and CUDA Clusters</h3>
<div class="outline-text-3" id="text-3-5">
<p>
TRUBA has two main sections: <b><b>ARF</b></b> (Standard) and <b><b>CUDA</b></b> (GPU-focused).
</p>

<ul class="org-ul">
<li><b><b>ARF Access:</b></b> <a href="https://172.16.6.20">https://172.16.6.20</a></li>
<li><p>
<b><b>CUDA Access:</b></b> <a href="https://172.16.6.16">https://172.16.6.16</a> (Requires special authorization)
</p>

<p>
Access to the CUDA cluster requires authorization. See the official documentation:
</p></li>
</ul>

<p>
<a href="https://docs.truba.gov.tr/1-kaynaklar/arf_acc/arf_acc_baglanti.html#arf-acc-baglanti">https://docs.truba.gov.tr/1-kaynaklar/arf_acc/arf_acc_baglanti.html#arf-acc-baglanti</a>
</p>


<p>
Your files, settings, and MATLAB preferences are shared between both clusters. 
</p>

<ul class="org-ul">
<li><b><b>Settings Folder:</b></b> <code>~/.matlab/</code> (This stores your preferences).</li>
<li><b><b>Home Directory:</b></b> <code>/arf/home/$USER</code> (This is where your files live).</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-orgd45a62e" class="outline-2">
<h2 id="orgd45a62e"><span class="section-number-2">4.</span> Configuring MATLAB to Submit Jobs from Local MATLAB to TRUBA</h2>
<div class="outline-text-2" id="text-4">
<p>
This section describes how to configure MATLAB installed on your local
computer to submit jobs remotely to the TRUBA cluster.
</p>

<p>
This configuration:
</p>

<ul class="org-ul">
<li>Is required only if MATLAB is installed on your personal machine.</li>
<li>Must be performed once per Slurm cluster (e.g., ARF or CUDA).</li>
<li>Must be repeated for each MATLAB version installed locally.</li>
</ul>
</div>

<div id="outline-container-org505a528" class="outline-3">
<h3 id="org505a528"><span class="section-number-3">4.1.</span> Verify Your User Path</h3>
<div class="outline-text-3" id="text-4-1">
<p>
MATLAB needs a specific folder to store the TRUBA connection scripts.
</p>
<ul class="org-ul">
<li>Open MATLAB on your computer.</li>
<li>Type <code>userpath</code> in the Command Window.</li>
<li>If it returns a folder, that is where we will put the plugin.</li>
<li>If it is empty, type <code>userpath('reset')</code> to fix it.</li>
</ul>



<div id="org3dabbf6" class="figure">
<p><img src="images/local_userpath_output.png" alt="local_userpath_output.png" />
</p>
<p><span class="figure-number">Figure 3: </span>MATLAB userpath after reset</p>
</div>

<p>
If necessary, manually create a MATLAB directory under your
Documents folder and set it as the user path:
</p>

<div class="org-src-container">
<pre class="src src-matlab">mkdir(fullfile(getenv('HOME'),'Documents','MATLAB'))
userpath(fullfile(getenv('HOME'),'Documents','MATLAB'))
savepath
</pre>
</div>
</div>
</div>


<div id="outline-container-orga65c415" class="outline-3">
<h3 id="orga65c415"><span class="section-number-3">4.2.</span> Install the TRUBA Cluster Plugin</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>Download the <b><b>TRUBA MATLAB Plugin (ZIP)??????? Add the folder link</b></b>.</li>
<li>Extract the files directly into the folder you found in the step above.</li>
<li><p>
In the MATLAB Command Window, run:
(This will create a TRUBA cluster profile configured for Slurm submission.)
</p>
<div class="org-src-container">
<pre class="src src-matlab">  configCluster
</pre>
</div></li>
<li>Follow the prompts: Select the cluster (ARF or CUDA) and enter your <b><b>TRUBA username</b></b>.</li>
</ul>

<div class="NOTE" id="orgd589ad1">
<p>
You won't be asked for a password yet. You will enter your password only when you actually "send" a job to the cluster.
</p>

</div>


<div id="org347a64c" class="figure">
<p><img src="images/configCluster_execution.png" alt="configCluster_execution.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Running configCluster and selecting TRUBA ARF</p>
</div>

<p>
After successful configuration, jobs submitted from MATLAB
will run on the TRUBA cluster instead of the local machine.
</p>

<p>
You can also see  the cluster profile from GUI Home -&gt; Parallel -&gt; Create and Manage Clusters  
</p>

<div id="orgb2c3718" class="figure">
<p><img src="images/cluster_profile_manager.png" alt="cluster_profile_manager.png" />
</p>
<p><span class="figure-number">Figure 5: </span>TRUBA ARF cluster profile visible in Cluster Profile Manager</p>
</div>
</div>
</div>


<div id="outline-container-org24ec2e5" class="outline-3">
<h3 id="org24ec2e5"><span class="section-number-3">4.3.</span> Switching Between Your Computer and the Cluster</h3>
<div class="outline-text-3" id="text-4-3">
<p>
While TRUBA handles the massive calculations, you will still need to run small, immediate tasks on your own computer's hardware. This is managed through different "Profiles."
</p>
</div>

<div id="outline-container-org4843764" class="outline-4">
<h4 id="org4843764"><span class="section-number-4">4.3.1.</span> Setting Up Your Local Profile</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
Before you start, ensure you have a "local" profile to handle work on your own laptop.
</p>
<ul class="org-ul">
<li>Go to the <b><b>Home</b></b> tab in MATLAB.</li>
<li>Click <b><b>Parallel</b></b> &gt; <b><b>Create and Manage Clusters</b></b>.</li>
<li>Check the list on the left. If you do not see a profile named <b><b>Processes</b></b> or <b><b>local</b></b>, click <b><b>Add Cluster Profile</b></b> &gt; <b><b>Processes</b></b>.</li>
<li>This ensures you can always switch back to "Laptop mode" when you aren't using the cluster.</li>
</ul>


<div id="org9653e0a" class="figure">
<p><img src="images/cluster_profile_manager.png" alt="cluster_profile_manager.png" />
</p>
<p><span class="figure-number">Figure 6: </span>TRUBA ARF cluster profile visible in Cluster Profile Manager</p>
</div>
</div>
</div>

<div id="outline-container-org79d4ff3" class="outline-4">
<h4 id="org79d4ff3"><span class="section-number-4">4.3.2.</span> How to Switch Profiles in Your Code</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
You can tell MATLAB where to run your work by using a simple command. This is helpful if you want to test a small part of your code locally before sending the whole thing to TRUBA.
</p>

<ul class="org-ul">
<li><p>
<b><b>To work on TRUBA (Default):</b></b>
</p>
<div class="org-src-container">
<pre class="src src-matlab">  c = parcluster; % This loads your default TRUBA profile
</pre>
</div></li>

<li><p>
<b><b>To work on your own Laptop:</b></b>
</p>
<div class="org-src-container">
<pre class="src src-matlab">  % This tells MATLAB to use your computer's own processors
  c = parcluster('Processes'); 
</pre>
</div></li>
</ul>

<div class="TIP" id="orgaf9e27e">
<p>
<b>Rookie Tip:</b> Think of the "Processes" profile as your personal workspace and the "TRUBA" profile as the heavy-duty factory. Only send work to the factory when it is too big for your workspace!
</p>

</div>
</div>
</div>
</div>
</div>






<div id="outline-container-orga052ce1" class="outline-2">
<h2 id="orga052ce1"><span class="section-number-2">5.</span> Configuring Jobs (Scheduler Parameters (Slurm Options))</h2>
<div class="outline-text-2" id="text-5">
<p>
Before submitting jobs from MATLAB to TRUBA, users are strongly advised to have
basic familiarity with Slurm concepts such as partitions, wall time, CPUs, and
memory and available partitions.
</p>

<ul class="org-ul">
<li>Slurm job script fundamentals:
<a href="https://docs.truba.gov.tr/2-temel_bilgiler/slurm-betik-ozellik.html">https://docs.truba.gov.tr/2-temel_bilgiler/slurm-betik-ozellik.html</a></li>

<li>Overview of TRUBA computing clusters / partitions:
<a href="https://docs.truba.gov.tr/2-temel_bilgiler/hesaplama_kumeleri.html">https://docs.truba.gov.tr/2-temel_bilgiler/hesaplama_kumeleri.html</a></li>
</ul>
</div>



<div id="outline-container-org6e1a0cf" class="outline-3">
<h3 id="org6e1a0cf"><span class="section-number-3">5.1.</span> Understanding Slurm: The Cluster "Booking System"</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Before you send work to TRUBA, you need to understand three basic concepts. Think of it like booking a hotel room:
</p>
<ul class="org-ul">
<li><b><b>Partition:</b></b> Which "wing" of the building you want to stay in (e.g., standard, luxury, or specialized GPU rooms).</li>
<li><b><b>WallTime:</b></b> How long you intend to stay. If you stay past checkout, the system will automatically end your session.</li>
<li><b><b>Resources:</b></b> How many beds (CPUs) and how much space (Memory) you need.</li>
</ul>
</div>


<div id="outline-container-orgff03b43" class="outline-4">
<h4 id="orgff03b43"><span class="section-number-4">5.1.1.</span> Listing Available Partitions from MATLAB</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
NOTE: Documentation pages may not always reflect the most up-to-date partition
configuration. You can query the available partitions directly from MATLAB using
the TRUBA cluster profile.
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
clusterPartitionNames(c)
</pre>
</div>

<p>
Example output:
</p>

<pre class="example" id="orgadbeac6">
{'akya-cuda' }
{'barbun' }
{'barbun-cuda'}
{'debug' }
{'hamsi' }
{'orfoz' }
{'smp' }
</pre>
</div>
</div>
</div>


<div id="outline-container-orge8aa4f7" class="outline-3">
<h3 id="orge8aa4f7"><span class="section-number-3">5.2.</span> Slurm Options Exposed by the TRUBA MATLAB Profile</h3>
<div class="outline-text-3" id="text-5-2">
<p>
To view the current slurm site configuration used by the profile:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
c.AdditionalProperties
</pre>
</div>
</div>
</div>


<div id="outline-container-orge9c243c" class="outline-3">
<h3 id="orge9c243c"><span class="section-number-3">5.3.</span> What You Typically Need to Specify</h3>
<div class="outline-text-3" id="text-5-3">
<p>
When submitting jobs to TRUBA, you should generally define at least:
</p>

<ol class="org-ol">
<li><b>Partition</b> (<code>c.AdditionalProperties.Partition</code>)
<ul class="org-ul">
<li>For initial testing, we recommend using <code>debug</code>.</li>
</ul></li>

<li><b>Requested compute size</b> (MATLAB workers)
<ul class="org-ul">
<li>When submitting jobs from MATLAB, the size of the job is typically controlled
by the <b>pool size</b> (see the minimal test job below).</li>
<li>Some partitions enforce policies on job size. For example, on <code>orfoz</code> you may
be required to request 56×n (where n is integer) cores.</li>
</ul></li>

<li><b>Wall time</b> (<code>c.AdditionalProperties.WallTime</code>)
<ul class="org-ul">
<li>This is required.</li>
<li>Keep it short for tests (e.g., 15–2 minutes).</li>
<li>Maximum wall time depends on partition/site policy.</li>
</ul></li>
</ol>
</div>
</div>


<div id="outline-container-org1c982d1" class="outline-3">
<h3 id="org1c982d1"><span class="section-number-3">5.4.</span> Your First "Hello World Job"  (Recommended)</h3>
<div class="outline-text-3" id="text-5-4">
<p>
This minimal test submits a simple job that returns the working directory (<code>pwd</code>).
It is designed to be small, predictable, and suitable for first-time validation.
</p>

<p>
We explicitly set:
</p>

<ul class="org-ul">
<li><code>Partition</code> to <code>debug</code> (small jobs are accepted)</li>
<li><code>NumNodes</code> to <code>1</code> (avoid accidental multi-node allocation for a tiny test)</li>
<li><code>WallTime</code> to a short value</li>
</ul>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;

% Recommended baseline for a first test
c.AdditionalProperties.Partition = 'debug';
c.AdditionalProperties.NumNodes  = 1;
c.AdditionalProperties.WallTime  = '0-00:10';

% Submit a pool job (Pool&gt;=2) and disable client-path propagation
j = batch(c, @pwd, 1, {}, ...
    'Pool', 2, ...
    'CurrentFolder', '.', ...
    'AutoAddClientPath', false);
</pre>
</div>

<p>
When this job is submitted, MATLAB generates a Slurm submission script.
You can see the actual Slurm flags in the submission output.
</p>
</div>


<div id="outline-container-orgfbec78e" class="outline-4">
<h4 id="orgfbec78e"><span class="section-number-4">5.4.1.</span> Understanding the <code>batch</code> Command</h4>
<div class="outline-text-4" id="text-5-4-1">
<p>
The following command submits a job to the TRUBA cluster:
</p>

<div class="org-src-container">
<pre class="src src-matlab">j = batch(c, @pwd, 1, {}, ...
    'Pool', 2, ...
    'CurrentFolder', '.', ...
    'AutoAddClientPath', false);
</pre>
</div>

<p>
Explanation of the arguments:
</p>

<ul class="org-ul">
<li><code>c</code>  
The TRUBA cluster profile created earlier.</li>

<li><code>@pwd</code>  
The function to execute on the cluster.  
In this minimal test, <code>pwd</code> simply returns the working directory.</li>

<li><code>1</code>  
Number of output arguments expected from the function.</li>

<li><code>{}</code>  
Cell array of input arguments to the function (empty in this example).</li>

<li><code>'Pool', 2</code>  
Starts 2 MATLAB workers on the cluster.  
On TRUBA ARF, independent single-core jobs are not supported, so
a pool size of at least 2 is required for this test.</li>

<li><code>'CurrentFolder', '.'</code>  
Specifies the working directory from which the job is submitted.</li>

<li><p>
<code>'AutoAddClientPath', false</code>  
Prevents MATLAB from attempting to add local (e.g., macOS/Windows)
directories to the cluster workers' search path.
This avoids unnecessary warnings.
</p>

<p>
For convenience, the same command can be written in a single line:
</p></li>
</ul>

<p>
Internally, the pool size determines how many parallel worker processes
are launched on the cluster.
</p>


<div class="org-src-container">
<pre class="src src-matlab">j = batch(c,@pwd,1,{},'Pool',2,'CurrentFolder','.', 'AutoAddClientPath',false);
</pre>
</div>

<ul class="org-ul">
<li>When you run this command you will be asked the password you login to cluster:</li>
</ul>

<p>
Typical submission arguments may look like:
</p>

<pre class="example" id="orgbee8b87">
--ntasks=3
--cpus-per-task=1
-N 1
-p debug
-t 0-00:10
</pre>



<p>
NOTE:
</p>
<ul class="org-ul">
<li>On TRUBA ARF, submitting an independent single-core job without a pool may fail
with: "Single core jobs are not supported". For this reason, we use <code>Pool</code> in the
minimal test.</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgd75dba5" class="outline-3">
<h3 id="orgd75dba5"><span class="section-number-3">5.5.</span> The "Pool + 1" Rule: How Cores are Counted</h3>
<div class="outline-text-3" id="text-5-5">
<p>
This is the most common reason jobs are rejected. On TRUBA, if you ask for a parallel <b><b>Pool</b></b>, MATLAB uses <b><b>one extra CPU</b></b> to manage the workers.
</p>

<div class="IMPORTANT" id="org25d97f8">
<p>
<b><b>Total CPUs Used = Pool Size + 1</b></b>
If you set your Pool to <b><b>2</b></b>, Slurm sees a request for <b><b>3</b></b> CPUs.
</p>

</div>
</div>

<div id="outline-container-org3541446" class="outline-4">
<h4 id="org3541446"><span class="section-number-4">5.5.1.</span> Why does this matter?</h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
Some TRUBA partitions require you to request CPUs in specific "blocks" (multiples). For example, on the <b><b>orfoz</b></b> partition, you must request 56xn (where n is integer)  cores.
</p>
<ul class="org-ul">
<li>To use exactly <b><b>56 cores</b></b>, you must set your Pool to <b><b>55</b></b>.</li>
<li>(55 Workers + 1 Manager = 56 total).</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org7d0135c" class="outline-3">
<h3 id="org7d0135c"><span class="section-number-3">5.6.</span> Partition Policies on TRUBA</h3>
<div class="outline-text-3" id="text-5-6">
<p>
TRUBA enforces additional partition-specific job size policies at submission time.
These policies are checked automatically by the scheduler. If a job does not comply,
Slurm rejects it with an explanatory message.
</p>

<p>
The key idea is that policies are applied <b>per node</b>:
</p>

<ul class="org-ul">
<li>Per-node CPU request = (Total requested CPUs) / (NumNodes)</li>
</ul>
</div>

<div id="outline-container-org292a5d7" class="outline-4">
<h4 id="org292a5d7"><span class="section-number-4">5.6.1.</span> Summary of node sizes (informative)</h4>
<div class="outline-text-4" id="text-5-6-1">
<p>
From <code>scontrol show partition</code> output, the typical CPU core count per node is:
</p>

<ul class="org-ul">
<li><code>orfoz</code>: 112 CPU cores per node</li>
<li><code>hamsi</code>: 56 CPU cores per node</li>
<li><code>barbun</code>: 40 CPU cores per node</li>
<li><code>akya-cuda</code>: 40 CPU cores per node</li>
<li><code>barbun-cuda</code>: 40 CPU cores per node</li>
</ul>
</div>
</div>

<div id="outline-container-orgb296ded" class="outline-4">
<h4 id="orgb296ded"><span class="section-number-4">5.6.2.</span> CPU partitions: per-node CPU count rules</h4>
<div class="outline-text-4" id="text-5-6-2">
<ul class="org-ul">
<li><code>orfoz</code>
<ul class="org-ul">
<li>Requests must be <b>56×n</b> CPU cores per node (commonly 56 or 112).</li>
<li>If violated, Slurm may reject the job with a message such as:
"Orfoz kuyruguna gonderilen islerde node basina 56/112 cekirdek talep ediniz."</li>
</ul></li>

<li><code>hamsi</code>
<ul class="org-ul">
<li>Requests must be <b>56×n</b> CPU cores per node.</li>
</ul></li>

<li><code>barbun</code>
<ul class="org-ul">
<li>Requests must be <b>40×n</b> CPU cores per node.</li>
</ul></li>
</ul>

<p>
Practical recommendation:
</p>
<ul class="org-ul">
<li>Use <code>debug</code> for small test jobs.</li>
<li>Use the target partition for production jobs and request per-node CPU cores
in the allowed multiples.</li>
</ul>
</div>
</div>

<div id="outline-container-orgc27cc49" class="outline-4">
<h4 id="orgc27cc49"><span class="section-number-4">5.6.3.</span> GPU partitions: GPU request and CPU↔GPU ratio rules</h4>
<div class="outline-text-4" id="text-5-6-3">
<ul class="org-ul">
<li><code>akya-cuda</code>
<ul class="org-ul">
<li>A GPU request is mandatory.</li>
<li>CPU cores must be requested in multiples of 10.</li>
<li>Policy requires 1 GPU per 10 CPU cores per node.</li>
</ul></li>

<li><code>barbun-cuda</code>
<ul class="org-ul">
<li>A GPU request is mandatory.</li>
<li>CPU cores must be requested in multiples of 20.</li>
<li>Policy requires 1 GPU per 20 CPU cores per node.</li>
</ul></li>
</ul>

<p>
NOTE:
The exact GPU request syntax depends on the submission method.
When submitting through the TRUBA MATLAB plugin, GPU requests are set via
the cluster profile options (see the GPU example section later in this document).
</p>
</div>
</div>


<div id="outline-container-org472d986" class="outline-4">
<h4 id="org472d986"><span class="section-number-4">5.6.4.</span> Working directory policy</h4>
<div class="outline-text-4" id="text-5-6-4">
<p>
TRUBA requires jobs to run from <code>/arf/scratch</code> (recommended).
Jobs submitted from other directories may be rejected by site policy.
</p>

<p>
For MATLAB submissions, we recommend using:
</p>

<div class="org-src-container">
<pre class="src src-matlab">'CurrentFolder','.'
</pre>
</div>

<p>
when MATLAB is started in a directory under <code>/arf/scratch</code>.
</p>
</div>
</div>
</div>





<div id="outline-container-org9e3bd25" class="outline-3">
<h3 id="org9e3bd25"><span class="section-number-3">5.7.</span> CPU and Memory Relationship (Conceptual Model)</h3>
<div class="outline-text-3" id="text-5-7">
<p>
On TRUBA, most partitions follow a <b>memory-per-CPU</b> allocation model.
</p>

<p>
This means:
</p>

<ul class="org-ul">
<li>Memory allocation scales with the number of requested CPU cores.</li>
<li>Requesting more cores results in proportionally more memory.</li>
</ul>

<p>
For example (conceptual):
</p>

<p>
If a node has:
</p>

<ul class="org-ul">
<li>112 CPU cores</li>
<li>256 GB RAM</li>
</ul>

<p>
Then approximate memory per core is:
</p>

<p>
<code>256 / 112 ≈ 2.3 GB per core</code>
</p>

<p>
If your job requires 100 GB RAM:
</p>

<p>
<code>100 / 2.3 ≈ 44 cores</code>
</p>

<p>
Even if your application is not CPU-intensive,
you may need to request additional cores to obtain sufficient memory.
</p>
</div>

<div id="outline-container-org6da566a" class="outline-4">
<h4 id="org6da566a"><span class="section-number-4">5.7.1.</span> Important: Responsible Resource Usage</h4>
<div class="outline-text-4" id="text-5-7-1">
<p>
Although increasing core count increases available memory:
</p>

<ul class="org-ul">
<li>Do not request excessive cores unnecessarily.</li>
<li>Choose a partition with higher memory-per-core when appropriate.</li>
</ul>

<p>
For example (based on current TRUBA configuration):
</p>

<ul class="org-ul">
<li><code>orfoz</code> → ~2000 MB per CPU</li>
<li><code>hamsi</code> → ~3400 MB per CPU</li>
<li><code>barbun</code> → ~8500 MB per CPU</li>
</ul>

<p>
For memory-heavy workloads, selecting a partition with higher
memory per CPU may reduce unnecessary CPU allocation.
</p>
</div>
</div>
</div>





<div id="outline-container-orgda56a53" class="outline-3">
<h3 id="orgda56a53"><span class="section-number-3">5.8.</span> Resource Selection Strategy</h3>
<div class="outline-text-3" id="text-5-8">
<p>
Before submitting your job, identify the workload type:
</p>
</div>

<div id="outline-container-orgdfc17f9" class="outline-4">
<h4 id="orgdfc17f9"><span class="section-number-4">5.8.1.</span> CPU-bound Jobs</h4>
<div class="outline-text-4" id="text-5-8-1">
<ul class="org-ul">
<li>Heavy numerical computation</li>
<li>Parallel loops</li>
<li>Linear algebra</li>
</ul>

<p>
→ Increase <b>Pool</b> size appropriately.
→ Match partition core constraints (e.g., 56-core blocks on <code>orfoz</code>).
</p>
</div>
</div>

<div id="outline-container-org2c57a82" class="outline-4">
<h4 id="org2c57a82"><span class="section-number-4">5.8.2.</span> Memory-bound Jobs</h4>
<div class="outline-text-4" id="text-5-8-2">
<ul class="org-ul">
<li>Large matrices</li>
<li>Large data loading</li>
<li>In-memory preprocessing</li>
</ul>

<p>
→ Estimate required memory.
→ Compute approximate cores needed via memory-per-CPU model.
→ Prefer partitions with higher DefMemPerCPU (e.g., <code>barbun</code>).
</p>
</div>
</div>

<div id="outline-container-org1da16a3" class="outline-4">
<h4 id="org1da16a3"><span class="section-number-4">5.8.3.</span> GPU-bound Jobs</h4>
<div class="outline-text-4" id="text-5-8-3">
<ul class="org-ul">
<li>Deep learning</li>
<li>CUDA-based computation</li>
</ul>

<p>
→ Use GPU partitions (<code>akya-cuda</code>, <code>barbun-cuda</code>).
→ Ensure GPU-to-CPU ratio follows partition policy.
</p>
</div>
</div>
</div>



<div id="outline-container-org2cfe416" class="outline-3">
<h3 id="org2cfe416"><span class="section-number-3">5.9.</span> Monitoring the Job</h3>
<div class="outline-text-3" id="text-5-9">
<p>
After submitting the job, you can monitor its status both from MATLAB
and from the TRUBA command line.
</p>
</div>

<div id="outline-container-org7d520d4" class="outline-4">
<h4 id="org7d520d4"><span class="section-number-4">5.9.1.</span> From MATLAB</h4>
<div class="outline-text-4" id="text-5-9-1">
<p>
Check the job state:
</p>

<div class="org-src-container">
<pre class="src src-matlab">j.State
</pre>
</div>

<p>
Possible states include:
</p>

<ul class="org-ul">
<li><b><b>queued:</b></b> You are in line.</li>
<li><b><b>running:</b></b> Calculations are happening.</li>
<li><b><b>finished:</b></b> Success!</li>
<li><b><b>failed:</b></b> Check your code for errors.</li>
</ul>

<p>
You can also inspect timing information:
</p>

<div class="org-src-container">
<pre class="src src-matlab">j.SubmitTime
j.StartTime
j.FinishTime
</pre>
</div>

<p>
Instead of checking the state manually over and over, you can tell MATLAB to pause and wait until the job is done.
</p>

<div class="org-src-container">
<pre class="src src-matlab">% This command pauses your MATLAB until the job finishes
wait(j)
</pre>
</div>
</div>
</div>


<div id="outline-container-org5c26fb2" class="outline-4">
<h4 id="org5c26fb2"><span class="section-number-4">5.9.2.</span> From the TRUBA Login Node (Slurm)</h4>
<div class="outline-text-4" id="text-5-9-2">
<p>
If you know the Slurm job ID (visible in submission output),
you can check:
</p>

<div class="org-src-container">
<pre class="src src-bash">squeue -u $<span style="color: #BA36A5;">USER</span>
</pre>
</div>

<p>
After completion:
</p>

<div class="org-src-container">
<pre class="src src-bash">sacct -j &lt;jobid&gt; --format=JobID,State,Elapsed,AllocCPUS,NodeList
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-org53cdab8" class="outline-3">
<h3 id="org53cdab8"><span class="section-number-3">5.10.</span> Fetching and Inspecting Job Results</h3>
<div class="outline-text-3" id="text-5-10">
<p>
Once the job state becomes <code>'finished'</code>, you can retrieve outputs and inspect logs.
</p>
</div>

<div id="outline-container-org8a03302" class="outline-4">
<h4 id="org8a03302"><span class="section-number-4">5.10.1.</span> Fetch outputs</h4>
<div class="outline-text-4" id="text-5-10-1">
<div class="org-src-container">
<pre class="src src-matlab">out = fetchOutputs(j);
out{1}
</pre>
</div>

<p>
NOTE:
Outputs are returned as a cell array even if there is a single output.
</p>
</div>
</div>

<div id="outline-container-org0f05b42" class="outline-4">
<h4 id="org0f05b42"><span class="section-number-4">5.10.2.</span> If the job failed</h4>
<div class="outline-text-4" id="text-5-10-2">
<p>
If <code>j.State</code> is <code>'failed'</code>, inspect the task error message:
</p>

<div class="org-src-container">
<pre class="src src-matlab">j.Tasks(1).Error
</pre>
</div>


<div class="TIP" id="org0588861">
<p>
<b><b>Pro Tip:</b></b> If your job failed, type <code>diary(j)</code>. This will print everything the cluster tried to say to the command window, including hidden error messages.
</p>

</div>

<div class="org-src-container">
<pre class="src src-matlab">diary(j)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd10447f" class="outline-4">
<h4 id="orgd10447f"><span class="section-number-4">5.10.3.</span> Working with multiple test jobs</h4>
<div class="outline-text-4" id="text-5-10-3">
<p>
If you closed MATLAB and lost the variable <code>j</code> or if you submit multiple jobs and no longer have the variable <code>j</code>,
you can list jobs associated with the cluster profile:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
c.Jobs
</pre>
</div>

<p>
To select the most recent job:
</p>

<div class="org-src-container">
<pre class="src src-matlab">j = c.Jobs(end);
</pre>
</div>



<p>
Then fetch outputs as usual:
</p>

<div class="org-src-container">
<pre class="src src-matlab">out = fetchOutputs(j);
out{1}
</pre>
</div>
</div>
</div>

<div id="outline-container-org875d470" class="outline-4">
<h4 id="org875d470"><span class="section-number-4">5.10.4.</span> Optional cleanup</h4>
<div class="outline-text-4" id="text-5-10-4">
<p>
To remove a completed job object and associated local metadata:
</p>

<div class="org-src-container">
<pre class="src src-matlab">delete(j)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd1885da" class="outline-4">
<h4 id="orgd1885da"><span class="section-number-4">5.10.5.</span> Deleting All Jobs from the Profile</h4>
<div class="outline-text-4" id="text-5-10-5">
<p>
To remove all stored job objects:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
delete(c.Jobs)
</pre>
</div>

<p>
This clears local job metadata stored in the cluster profile's
job storage directory.
</p>
































<hr />
</div>
</div>
</div>



<div id="outline-container-org0efea9c" class="outline-3">
<h3 id="org0efea9c"><span class="section-number-3">5.11.</span> Modifying or Unsetting Settings</h3>
<div class="outline-text-3" id="text-5-11">
<p>
You can change a value by assigning a new one, for example:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c.AdditionalProperties.WallTime = '0-00:30';
</pre>
</div>

<p>
To unset values (return to plugin defaults), use empty/zero/false values, e.g.:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c.AdditionalProperties.Partition = '';
c.AdditionalProperties.NumNodes  = 0;
c.AdditionalProperties.MemPerCPU = '';
c.AdditionalProperties.RequireExclusiveNode = false;
</pre>
</div>
</div>
</div>




<div id="outline-container-orgdebe50a" class="outline-3">
<h3 id="orgdebe50a"><span class="section-number-3">5.12.</span> Saving Settings</h3>
<div class="outline-text-3" id="text-5-12">
<p>
If you want MATLAB to reuse your current configuration in future sessions,
save the cluster profile:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c.saveProfile
</pre>
</div>

<p>
If you do not save the profile, changes are typically not persistent between
MATLAB sessions. If you have not saved the profile and want to revert all changes,
simply restart MATLAB.
</p>






<hr />
</div>
</div>
</div>



<div id="outline-container-org625caf1" class="outline-2">
<h2 id="org625caf1"><span class="section-number-2">6.</span> Advanced: Interactive Parallel Jobs from MATLAB on the Desktop</h2>
<div class="outline-text-2" id="text-6">
<p>
This section describes how to launch a parallel pool on TRUBA directly
from MATLAB running on your personal computer.
</p>

<p>
This workflow is recommended only for advanced users who need
interactive development while using cluster resources.
</p>

<p>
<b><b>Important:</b></b> This mode requires proper network configuration
between your computer and TRUBA worker nodes.
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Prerequisites</b></b>
</p>

<p>
To run an interactive pool job launched from your desktop onto TRUBA,
the following conditions must be satisfied:
</p>

<ol class="org-ol">
<li>You must be connected to the institutional VPN.</li>
<li>TCP port 27370 must be open for inbound traffic on your machine.</li>
<li>MATLAB must advertise your VPN private IP address to worker nodes.</li>
</ol>

<p>
To configure the hostname inside MATLAB:
</p>

<div class="org-src-container">
<pre class="src src-matlab">sethostname
</pre>
</div>

<p>
Expected output:
</p>

<div class="org-src-container">
<pre class="src src-matlab">Found private IP address.  Setting hostname: 10.x.x.x
</pre>
</div>

<p>
This command must be executed every time MATLAB is restarted.
Alternatively, add it to your `startup.m` file.
</p>

<p>
If your firewall blocks communication, you may see an error such as:
</p>

<p>
"Check whether a firewall is blocking communication between the worker machines and the MATLAB client machine."
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Starting a Parallel Pool on TRUBA</b></b>
</p>

<div class="org-src-container">
<pre class="src src-matlab">% Get cluster profile
c = parcluster;

% Start 28 workers (example)
pool = c.parpool(28);
</pre>
</div>

<p>
Explanation:
</p>

<ul class="org-ul">
<li>`parcluster` connects MATLAB to the TRUBA cluster profile.</li>
<li>`parpool(28)` submits a Slurm job that allocates 28 workers.</li>
<li>Workers may span multiple nodes depending on scheduler decisions.</li>
</ul>

<p>
The pool remains active until explicitly deleted.
</p>

<p>
&#x2014;
</p>
</div>

<div id="outline-container-org8fb94cc" class="outline-3">
<h3 id="org8fb94cc"><span class="section-number-3">6.1.</span> Interactive Parallel Work</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Instead of running a local pool on your own computer, your code can now run across multiple nodes on the TRUBA cluster simultaneously.
</p>

<div class="org-src-container">
<pre class="src src-matlab">% Single-line test: Measure time to generate 1,000 numbers and display the sum
tic; parfor idx = 1:1000, a(idx) = rand; end; result = sum(a), toc
</pre>
</div>
</div>
</div>



<div id="outline-container-org0567e6d" class="outline-3">
<h3 id="org0567e6d"><span class="section-number-3">6.2.</span> Closing the Pool</h3>
<div class="outline-text-3" id="text-6-2">
<p>
When you are finished with your parallel tasks, it is a good practice to shut down the pool to free up cluster resources:
</p>

<div class="org-src-container">
<pre class="src src-matlab">delete(gcp('nocreate'))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3beb6a2" class="outline-3">
<h3 id="org3beb6a2"><span class="section-number-3">6.3.</span> TRUBA Resource Constraints (Important)</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Desktop-based interactive pools do not bypass TRUBA scheduling rules.
</p>

<p>
Even when launching pools from MATLAB on your desktop,
all TRUBA partition constraints still apply.
</p>

<p>
The pool creation command internally submits a Slurm job.
If resource limits are violated, the job submission will fail.
</p>

<p>
Common error messages include:
</p>

<div class="org-src-container">
<pre class="src src-text">sbatch: error: Orfoz kuyruguna gonderilen isleride node basina 56/112 cekirdek talep ediniz.
sbatch: error: Batch job submission failed: Requested time limit is invalid (missing or exceeds some limit)
</pre>
</div>

<p>
These errors indicate that your requested configuration does not satisfy partition limits. See the above section for setting these parameters.
</p>

<p>
Typical causes:
</p>

<ul class="org-ul">
<li>Requesting more workers than allowed per node</li>
<li>Exceeding maximum walltime</li>
<li>Using incorrect partition</li>
<li>Not specifying required time limit</li>
</ul>

<p>
Before adjusting `parpool(N)`, verify:
</p>

<ul class="org-ul">
<li>The partition you are using</li>
<li>Maximum cores allowed per node</li>
<li>Maximum allowed walltime</li>
<li>Whether multi-node execution is permitted</li>
</ul>

<p>
Always ensure that:
</p>

<p>
requested workers ≤ allowed cores per node
</p>

<p>
If necessary, reduce the pool size or adjust it according to the cluster rules:
</p>

<div class="org-src-container">
<pre class="src src-matlab">pool = c.parpool(56);
</pre>
</div>

<p>
or adjust cluster profile settings as documented earlier.
</p>


<p>
<b><b>Simple Numerical Example</b></b>
</p>

<div class="org-src-container">
<pre class="src src-matlab">tic;
R = zeros(1,280);
parfor i = 1:280
    R(i) = sum(svd(rand(400)));
end
toc;
mean(R)
</pre>
</div>

<p>
Explanation:
</p>

<ul class="org-ul">
<li>280 iterations ensure sufficient work per worker.</li>
<li>Each iteration computes singular values of a random 400x400 matrix.</li>
<li>`mean(R)` provides numerical output.</li>
<li>`tic/toc` measures elapsed wall time.</li>
</ul>

<p>
To compare with serial execution:
</p>

<div class="org-src-container">
<pre class="src src-matlab">tic;
for i = 1:280
    sum(svd(rand(400)));
end
toc
</pre>
</div>

<p>
Parallel execution should show noticeable speedup for sufficiently large workloads.
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Understanding Overhead</b></b>
</p>

<p>
When you call `parpool`, MATLAB:
</p>

<ul class="org-ul">
<li>Submits a Slurm job</li>
<li>Allocates nodes</li>
<li>Starts worker MATLAB processes</li>
<li>Performs license checks</li>
<li>Establishes TCP connections</li>
<li>Synchronizes the environment</li>
</ul>

<p>
This startup phase can take from tens of seconds to several minutes.
</p>

<p>
If the actual computation is small (e.g., `parfor i=1:10, rand; end`),
startup overhead dominates and parallel execution may appear slow.
</p>

<p>
Parallel computing is beneficial only when:
</p>

<p>
computation time  &gt;&gt;  startup and communication overhead
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Monitoring Jobs</b></b>
</p>

<p>
When a pool is active, MATLAB Job Monitor shows:
</p>

<p>
Description: Interactive pool
State: running
</p>

<p>
This indicates that workers are allocated and idle or ready.
</p>

<p>
It does NOT necessarily mean that a `parfor` loop is currently executing.
</p>

<p>
As long as the pool is open, cluster resources remain allocated.
</p>
</div>
</div>

<div id="outline-container-orgf4e896f" class="outline-3">
<h3 id="orgf4e896f"><span class="section-number-3">6.4.</span> Opening Job Monitor</h3>
<div class="outline-text-3" id="text-6-4">
<p>
To view active pools and cluster jobs, open:
</p>

<p>
Parallel → Monitor Jobs
</p>


<div id="orga404a6f" class="figure">
<p><img src="images/open_job_monitor.png" alt="open_job_monitor.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Opening the Job Monitor from the MATLAB Parallel menu.</p>
</div>

<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-org1d02f76" class="outline-3">
<h3 id="org1d02f76"><span class="section-number-3">6.5.</span> Example: Job Monitor Window</h3>
<div class="outline-text-3" id="text-6-5">

<div id="orgcda1411" class="figure">
<p><img src="images/job_monitor_window.png" alt="job_monitor_window.png" />
</p>
<p><span class="figure-number">Figure 8: </span>MATLAB Job Monitor showing running and finished jobs.</p>
</div>

<p>
In this window:
</p>

<ul class="org-ul">
<li><b>Description: Interactive pool</b> indicates that a parallel pool is active.</li>
<li><b>State: running</b> means that worker processes are allocated.</li>
<li>This does <b><b>not</b></b> necessarily mean that a `parfor` loop is currently executing.</li>
</ul>

<p>
As long as the pool remains open, cluster resources stay allocated.
</p>


<p>
&#x2014;
</p>

<p>
<b><b>Closing the Pool</b></b>
</p>

<p>
Always delete the pool after finishing:
</p>

<div class="org-src-container">
<pre class="src src-matlab">delete(gcp)
</pre>
</div>

<p>
Failing to close the pool wastes compute resources.
</p>

<p>
Idle pools may be terminated automatically after a timeout
(currently ~30 minutes of inactivity; subject to change).
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Best Practice Recommendation</b></b>
</p>

<ul class="org-ul">
<li>Use this mode for interactive development only.</li>
<li>For production runs, use batch submission (`sbatch`).</li>
<li>If working inside an OnDemand desktop session, prefer a local pool
(`parpool('local',N)`) instead of submitting a second cluster job.</li>
</ul>
</div>
</div>
</div>







<div id="outline-container-org4dac4b1" class="outline-2">
<h2 id="org4dac4b1"><span class="section-number-2">7.</span> TRUBA MATLAB Helper Functions</h2>
<div class="outline-text-2" id="text-7">
<p>
TRUBA provides several helper functions that simplify interaction
with Slurm and cluster resources from within MATLAB.
</p>

<p>
These functions are optional but strongly recommended
for advanced usage and troubleshooting.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">clusterFeatures</td>
<td class="org-left">Lists cluster features and node constraints</td>
<td class="org-left">Useful for understanding partition limits</td>
</tr>

<tr>
<td class="org-left">clusterGpuCards</td>
<td class="org-left">Lists available GPU models on TRUBA</td>
<td class="org-left">Use before requesting GPU resources</td>
</tr>

<tr>
<td class="org-left">clusterPartitionNames</td>
<td class="org-left">Lists available Slurm partitions/queues</td>
<td class="org-left">Verify before setting profile</td>
</tr>

<tr>
<td class="org-left">fixConnection</td>
<td class="org-left">Reestablishes cluster connection</td>
<td class="org-left">Applicable only for Desktop mode</td>
</tr>

<tr>
<td class="org-left">seff</td>
<td class="org-left">Displays Slurm efficiency statistics for a job</td>
<td class="org-left">Similar to Linux `seff` command</td>
</tr>

<tr>
<td class="org-left">willRun</td>
<td class="org-left">Explains why a job is queued</td>
<td class="org-left">Helps diagnose scheduling issues</td>
</tr>
</tbody>
</table>

<p>
&#x2014;
</p>

<p>
<b><b>Example Usage</b></b>
</p>

<div class="org-src-container">
<pre class="src src-matlab">clusterPartitionNames
</pre>
</div>

<p>
Lists available TRUBA partitions.
</p>

<div class="org-src-container">
<pre class="src src-matlab">clusterFeatures
</pre>
</div>

<p>
Displays node-level constraints such as maximum cores per node.
</p>

<div class="org-src-container">
<pre class="src src-matlab">seff(326528)
</pre>
</div>

<p>
Displays efficiency statistics for the given Slurm job ID.
</p>

<div class="org-src-container">
<pre class="src src-matlab">willRun(326528)
</pre>
</div>

<p>
Explains why a job is currently queued.
</p>

<div class="org-src-container">
<pre class="src src-matlab">fixConnection
</pre>
</div>

<p>
Useful after reconnecting to VPN if desktop pools fail.
</p>
</div>
</div>


<div id="outline-container-orgd827cfa" class="outline-2">
<h2 id="orgd827cfa"><span class="section-number-2">8.</span> Troubleshooting and Debugging</h2>
<div class="outline-text-2" id="text-8">
<p>
When a job fails or behaves unexpectedly, MATLAB provides
tools to retrieve log files and scheduler information.
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Retrieving Debug Logs</b></b>
</p>

<p>
If a serial or batch job produces an error,
use the `getDebugLog` method to view the error log.
</p>

<p>
For independent jobs (multiple tasks):
</p>

<div class="org-src-container">
<pre class="src src-matlab">c.getDebugLog(job.Tasks)
</pre>
</div>

<p>
For pool jobs:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c.getDebugLog(job)
</pre>
</div>

<p>
The debug log contains detailed error messages generated
by MATLAB workers on TRUBA.
</p>

<p>
&#x2014;
</p>

<p>
<b><b>Retrieving Scheduler Job ID</b></b>
</p>

<p>
Cluster administrators may request the Slurm job ID
for troubleshooting purposes.
</p>

<p>
You can obtain the scheduler ID by calling:
</p>

<div class="org-src-container">
<pre class="src src-matlab">job.getTaskSchedulerIDs()
</pre>
</div>

<p>
Example output:
</p>

<div class="org-src-container">
<pre class="src src-matlab">ans =
    25539
</pre>
</div>

<p>
This number corresponds to the Slurm job ID
visible via `squeue` or `sacct` on TRUBA.
</p>
</div>


<div id="outline-container-orga9d529e" class="outline-3">
<h3 id="orga9d529e"><span class="section-number-3">8.1.</span> Licensing Issues</h3>
<div class="outline-text-3" id="text-8-1">
<p>
MATLAB jobs running on TRUBA require valid licenses for:
</p>
<ul class="org-ul">
<li>MATLAB</li>
<li>Parallel Computing Toolbox (for pool jobs / parpool / batch with Pool)</li>
</ul>

<p>
Symptoms of licensing problems may include:
</p>
<ul class="org-ul">
<li>Job fails immediately after submission</li>
<li>Workers cannot start</li>
<li>parpool hangs or reports license checkout failures</li>
</ul>
</div>

<div id="outline-container-orgdecba72" class="outline-4">
<h4 id="orgdecba72"><span class="section-number-4">8.1.1.</span> Check license availability (local MATLAB)</h4>
<div class="outline-text-4" id="text-8-1-1">
<div class="org-src-container">
<pre class="src src-matlab">license('test','Distrib_Computing_Toolbox')
</pre>
</div>

<p>
Return value:
</p>
<ul class="org-ul">
<li>1  -&gt; toolbox license available</li>
<li>0  -&gt; not available</li>
</ul>

<div class="org-src-container">
<pre class="src src-matlab">license('inuse')
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3790b6" class="outline-4">
<h4 id="orgf3790b6"><span class="section-number-4">8.1.2.</span> Check license status on TRUBA (if permitted)</h4>
<div class="outline-text-4" id="text-8-1-2">
<div class="org-src-container">
<pre class="src src-bash">lmstat -a
</pre>
</div>

<p>
If you cannot access license tools on TRUBA, include the Slurm job ID and job debug logs
when contacting TRUBA support (see: Retrieving Debug Logs / Retrieving Scheduler Job ID).
</p>
</div>
</div>
</div>
</div>





<div id="outline-container-org861004b" class="outline-2">
<h2 id="org861004b"><span class="section-number-2">9.</span> EXAMPLES (Cheatsheet)</h2>
<div class="outline-text-2" id="text-9">
<p>
You tell MATLAB how to "book" your resources using the <code>AdditionalProperties</code> command. Here is the minimal set you should always define:
</p>

<div class="org-src-container">
<pre class="src src-matlab"># set partition name
  c.AdditionalProperties.Partition = 'debug';
# set time limit
  c.AdditionalProperties.WallTime = '0-00:10'; % Format is days-hours:minutes
# set node count
  c.AdditionalProperties.NumNodes = 1; % For most beginners, starting with 1 node is best.
</pre>
</div>
</div>

<div id="outline-container-org5e89c0e" class="outline-3">
<h3 id="org5e89c0e"><span class="section-number-3">9.1.</span> What Happens After You Submit a Job?</h3>
<div class="outline-text-3" id="text-9-1">
<p>
After submission, the job enters the Slurm queue.
The start time depends on:
</p>

<ul class="org-ul">
<li>Current cluster load</li>
<li>Partition priority</li>
<li>Requested resources (nodes, GPUs, walltime)</li>
</ul>

<p>
The job may remain in <code>queued</code> state for some time before running.
</p>
</div>

<div id="outline-container-org566ae5e" class="outline-4">
<h4 id="org566ae5e"><span class="section-number-4">9.1.1.</span> You Can Close MATLAB</h4>
<div class="outline-text-4" id="text-9-1-1">
<p>
Once the job is submitted:
</p>

<ul class="org-ul">
<li>You may close MATLAB.</li>
<li>You may shut down your desktop session.</li>
<li>The job continues to run on TRUBA.</li>
</ul>

<p>
To check the job later:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
c.Jobs
</pre>
</div>

<p>
Or from the login node:
</p>

<div class="org-src-container">
<pre class="src src-bash">squeue -u $<span style="color: #BA36A5;">USER</span>
</pre>
</div>
</div>
</div>
</div>



















































<div id="outline-container-orgc2a62c6" class="outline-3">
<h3 id="orgc2a62c6"><span class="section-number-3">9.2.</span> Example: Running on the <code>orfoz</code> Partition (56-core half-node)</h3>
<div class="outline-text-3" id="text-9-2">
<p>
On <code>orfoz</code>, TRUBA enforces a per-node CPU policy: jobs must request
56 or 112 CPU cores per node.
</p>

<p>
IMPORTANT:
For MATLAB pool jobs, the Slurm plugin requests:
</p>

<ul class="org-ul">
<li><code>Total Slurm tasks = Pool + 1</code></li>
</ul>

<p>
(The extra 1 task is used for job orchestration.)
</p>

<p>
Therefore, to request <b>56 cores per node</b> on <code>orfoz</code>, you must set:
</p>

<ul class="org-ul">
<li><code>Pool = 55</code>  → Slurm submits <code>--ntasks=56</code></li>
</ul>
</div>

<div id="outline-container-org55579de" class="outline-4">
<h4 id="org55579de"><span class="section-number-4">9.2.1.</span> Correct example (half node on <code>orfoz</code>)</h4>
<div class="outline-text-4" id="text-9-2-1">
<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
c.AdditionalProperties.Partition = 'orfoz';
c.AdditionalProperties.NumNodes  = 1;
c.AdditionalProperties.WallTime  = '0-00:30';

j = batch(c, @pwd, 1, {}, ...
    'Pool', 55, ...
    'CurrentFolder', '.', ...
    'AutoAddClientPath', false);
</pre>
</div>



<p>
IMPORTANT:
On partitions with per-node core policies (e.g., <code>orfoz</code>), always set:
</p>

<ul class="org-ul">
<li><code>c.AdditionalProperties.NumNodes</code></li>
</ul>

<p>
If <code>NumNodes</code> is left unset, Slurm may place the job in a way that violates per-node policies.
</p>


<p>
For a half-node job on <code>orfoz</code>, use:
</p>

<ul class="org-ul">
<li><code>NumNodes = 1</code></li>
<li><code>Pool = 55</code>  (because MATLAB requests <code>Pool+1</code> tasks → 56 total)</li>
</ul>
</div>
</div>


<div id="outline-container-org8ed2f57" class="outline-4">
<h4 id="org8ed2f57"><span class="section-number-4">9.2.2.</span> Common mistake (will be rejected)</h4>
<div class="outline-text-4" id="text-9-2-2">
<p>
If you use <code>Pool=56</code>, MATLAB will submit <code>--ntasks=57</code>, and Slurm rejects it:
</p>

<pre class="example" id="orge422682">
sbatch: error: Orfoz kuyruguna gonderilen islerde node basina 56/112 cekirdek talep ediniz.
</pre>
</div>
</div>


<div id="outline-container-org6723dc0" class="outline-4">
<h4 id="org6723dc0"><span class="section-number-4">9.2.3.</span> Slurm Command Generated by MATLAB</h4>
<div class="outline-text-4" id="text-9-2-3">
<p>
When you submit the job, MATLAB prints the exact Slurm
arguments used for submission:
</p>

<pre class="example" id="orga11ed8e">
Submit arguments:
--ntasks=55 --cpus-per-task=1 -D /arf/scratch/$USER \
--ntasks-per-core=1 -t 0-3:00 -C orfoz -N 1 -p orfoz
</pre>

<p>
This shows how MATLAB parameters map to Slurm options:
</p>

<ul class="org-ul">
<li><code>Pool</code> → total tasks (&#x2013;ntasks)</li>
<li><code>NumNodes</code> → -N</li>
<li><code>Partition</code> → -p</li>
<li><code>Constraint</code> → -C</li>
<li><code>WallTime</code> → -t</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org268251f" class="outline-3">
<h3 id="org268251f"><span class="section-number-3">9.3.</span> Example: Submitting a GPU Job (<code>barbun-cuda</code>)</h3>
<div class="outline-text-3" id="text-9-3">
<p>
This section shows a minimal <b>GPU</b> test job submission from MATLAB to TRUBA.
</p>
</div>

<div id="outline-container-orged320c6" class="outline-4">
<h4 id="orged320c6"><span class="section-number-4">9.3.1.</span> Key policy on <code>barbun-cuda</code></h4>
<div class="outline-text-4" id="text-9-3-1">
<p>
TRUBA enforces CPU↔GPU request rules on GPU partitions.
</p>

<p>
On <code>barbun-cuda</code>:
</p>

<ul class="org-ul">
<li>A GPU request is mandatory.</li>
<li>CPU cores per node must be requested in multiples of 20.</li>
<li>Policy requires <b>1 GPU per 20 CPU cores per node</b>.</li>
</ul>

<p>
Since MATLAB pool jobs submit an extra orchestration task, the Slurm plugin typically requests:
</p>

<ul class="org-ul">
<li><code>Total Slurm tasks = Pool + 1</code></li>
</ul>

<p>
This matters when matching the required CPU counts.
</p>
</div>
</div>

<div id="outline-container-orgcef1bfe" class="outline-4">
<h4 id="orgcef1bfe"><span class="section-number-4">9.3.2.</span> Hardware note</h4>
<div class="outline-text-4" id="text-9-3-2">
<p>
The <code>barbun-cuda</code> nodes provide <b>2 GPUs per node</b>.
</p>

<p>
A common valid request for one node is therefore:
</p>

<ul class="org-ul">
<li>2 GPUs per node</li>
<li>40 CPU cores per node</li>
</ul>
</div>
</div>

<div id="outline-container-org915518e" class="outline-4">
<h4 id="org915518e"><span class="section-number-4">9.3.3.</span> Minimal valid GPU test job (2 GPUs, 40 CPUs on 1 node)</h4>
<div class="outline-text-4" id="text-9-3-3">
<p>
Configure the cluster profile:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;

% Target partition
c.AdditionalProperties.Partition = 'barbun-cuda';

% Request 1 node for the test
c.AdditionalProperties.NumNodes = 1;

% Set a short walltime for testing
c.AdditionalProperties.WallTime = '0-00:30';

% Request 2 GPUs on the node
c.AdditionalProperties.GPUsPerNode = 2;
</pre>
</div>

<p>
Submit a minimal job.
</p>

<p>
To satisfy the 40-CPU requirement on one node, set:
</p>

<ul class="org-ul">
<li><code>Pool = 39</code>  → Slurm submits <code>--ntasks=40</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-matlab">j = batch(c, @gpuDeviceCount, 1, {}, ...
    'Pool', 39, ...
    'CurrentFolder', '.', ...
    'AutoAddClientPath', false);
</pre>
</div>

<p>
Fetch and inspect results:
</p>

<div class="org-src-container">
<pre class="src src-matlab">wait(j);
out = fetchOutputs(j);
out{1}
</pre>
</div>

<p>
Expected output is the number of GPUs visible to the worker (typically 2).
</p>
</div>
</div>

<div id="outline-container-org039665b" class="outline-4">
<h4 id="org039665b"><span class="section-number-4">9.3.4.</span> Slurm command generated by MATLAB</h4>
<div class="outline-text-4" id="text-9-3-4">
<p>
When submitting, MATLAB prints the Slurm arguments used by the plugin.
A successful submission should include:
</p>

<ul class="org-ul">
<li><code>-p barbun-cuda</code></li>
<li><code>-N 1</code></li>
<li><code>--ntasks=40</code></li>
<li>a GPU request (gres / TRES)</li>
</ul>

<pre class="example" id="orge9bf84e">
Submit arguments: --ntasks=40 --cpus-per-task=1 -D /arf/scratch/$USER --ntasks-per-core=1 -t 0-00:30 --gres=gpu:2 -N 1 -p barbun-cuda
</pre>

<p>
Use this output to verify that the request matches TRUBA policy
(e.g., CPUs and GPUs requested per node).
</p>
</div>
</div>

<div id="outline-container-orgaaf6dd0" class="outline-4">
<h4 id="orgaaf6dd0"><span class="section-number-4">9.3.5.</span> Common mistakes (and what happens)</h4>
<div class="outline-text-4" id="text-9-3-5">
</div>
<ol class="org-ol">
<li><a id="orgfcc7b46"></a>Missing GPU request<br />
<div class="outline-text-5" id="text-9-3-5-1">
<p>
If you submit to <code>barbun-cuda</code> without requesting a GPU, Slurm will reject the job.
</p>

<p>
Typical message:
</p>

<pre class="example" id="org4217ede">
barbn-cuda kuyruguna sadece GPU talebi olan isler gonderilebilir.
</pre>
</div>
</li>

<li><a id="orgee553f1"></a>CPU/GPU mismatch<br />
<div class="outline-text-5" id="text-9-3-5-2">
<p>
If you request 2 GPUs but do not request 40 CPUs per node (multiples of 20 per GPU),
Slurm will reject the job.
</p>

<p>
Examples that are likely to fail:
</p>

<ul class="org-ul">
<li>Too few CPUs for 2 GPUs (e.g., 20 CPUs with 2 GPUs)</li>
<li>CPU count not a multiple of 20</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org8c0a8f7" class="outline-4">
<h4 id="org8c0a8f7"><span class="section-number-4">9.3.6.</span> Tips</h4>
<div class="outline-text-4" id="text-9-3-6">
<ul class="org-ul">
<li>Start GPU tests with short walltime and 1 node.</li>
<li>Keep your working directory under <code>/arf/scratch</code>.</li>
<li>If you see a policy-related rejection, first check:
<ul class="org-ul">
<li><code>Partition</code></li>
<li><code>NumNodes</code></li>
<li><code>GPUsPerNode</code></li>
<li><code>Pool</code> (remember <code>Pool + 1</code> tasks)</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>








<div id="outline-container-org036fc34" class="outline-2">
<h2 id="org036fc34"><span class="section-number-2">10.</span> A parfor Example (Four Execution Methods)</h2>
<div class="outline-text-2" id="text-10">
<p>
In this section, we demonstrate the same <code>parfor</code> example using four different
execution methods:
</p>

<ol class="org-ol">
<li>Submitting from a local MATLAB session configured with the TRUBA cluster profile</li>
<li>Running interactively on TRUBA with <code>parpool</code></li>
<li>Submitting via a Slurm batch script</li>
<li>Submitting via Open OnDemand</li>
</ol>

<p>
The test function used in all cases is shown below.
</p>

<div class="org-src-container">
<pre class="src src-matlab">function t = parfor_demo()
% Simple parfor timing demo (runs on workers)
N = 55;

tic
parfor i = 1:N
    pause(1);
end
t = toc;

fprintf("parfor_demo: N=%d, elapsed=%.2f s\n", N, t);
end
</pre>
</div>

<p>
We use the <code>orfoz</code> partition with 56 cores per node. Since MATLAB’s Slurm
integration uses one orchestration task in addition to the worker pool,
we set:
</p>

<ul class="org-ul">
<li><code>Pool = 55</code></li>
<li><code>NumNodes = 1</code></li>
</ul>

<p>
so that the total requested tasks become 56.
</p>
</div>

<div id="outline-container-org0b53745" class="outline-3">
<h3 id="org0b53745"><span class="section-number-3">10.1.</span> Why Parallelization Matters</h3>
<div class="outline-text-3" id="text-10-1">
<p>
Each iteration takes approximately one second (<code>pause(1)</code>).  
With <code>N = 55</code>, a serial loop would take approximately:
</p>

<pre class="example" id="orge8c2ce8">
55 iterations × 1 second ≈ 55 seconds
</pre>

<p>
When using <code>parfor</code> with a pool of 55 workers, all iterations are dispatched
concurrently in a single execution wave. The theoretical minimum runtime is:
</p>

<pre class="example" id="org39eac1e">
≈ 1 second
</pre>

<p>
In practice, the measured runtime is slightly higher (e.g., around
1.8–2.0 seconds) due to parallel overhead, including:
</p>

<ul class="org-ul">
<li>Task scheduling</li>
<li>Worker communication</li>
<li>Synchronization barriers</li>
<li>System-level latency</li>
</ul>

<p>
Even with this overhead, the wall-clock time decreases from nearly one
minute to just a few seconds. This confirms that the allocated CPU cores
are actively utilized instead of remaining idle.
</p>
</div>
</div>


<div id="outline-container-org8b2e8c4" class="outline-3">
<h3 id="org8b2e8c4"><span class="section-number-3">10.2.</span> Submitting from a Local MATLAB Session (Cluster Profile)</h3>
<div class="outline-text-3" id="text-10-2">
</div>
<div id="outline-container-orgd3deb09" class="outline-4">
<h4 id="orgd3deb09"><span class="section-number-4">10.2.1.</span> File Location and Execution Model</h4>
<div class="outline-text-4" id="text-10-2-1">
<p>
When MATLAB runs on a local machine using a TRUBA cluster profile,
the <code>.m</code> file does not need to be manually copied to TRUBA.
</p>

<p>
During job submission, MATLAB:
</p>

<ol class="org-ol">
<li>Packages the required function files</li>
<li>Transfers them to TRUBA</li>
<li>Submits the job to Slurm</li>
<li>Executes the job on compute nodes</li>
</ol>

<p>
The file must be located in the current working directory or on the
MATLAB path so that it can be staged correctly.
</p>

<p>
Once submitted, the job runs entirely on TRUBA compute nodes, and the
parallel workers execute on the allocated resources.
</p>
</div>
</div>

<div id="outline-container-orgc5e8698" class="outline-4">
<h4 id="orgc5e8698"><span class="section-number-4">10.2.2.</span> Cluster Configuration</h4>
<div class="outline-text-4" id="text-10-2-2">
<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
c.AdditionalProperties.Partition = 'orfoz';
c.AdditionalProperties.NumNodes  = 1;
c.AdditionalProperties.WallTime  = '0-00:30';
</pre>
</div>
</div>
</div>

<div id="outline-container-org8281c91" class="outline-4">
<h4 id="org8281c91"><span class="section-number-4">10.2.3.</span> Job Submission</h4>
<div class="outline-text-4" id="text-10-2-3">
<div class="org-src-container">
<pre class="src src-matlab">j = batch(c, @parfor_demo, 1, {}, ...
    'Pool', 55, ...
    'CurrentFolder'1, '.', ...
    'AutoAddClientPath', false);
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ac3c1e" class="outline-4">
<h4 id="org0ac3c1e"><span class="section-number-4">10.2.4.</span> Job Submission (File Already Exists on TRUBA)</h4>
<div class="outline-text-4" id="text-10-2-4">
<p>
If the script already exists on TRUBA (for example at:
</p>

<pre class="example" id="orgbd443ba">
/arf/scratch/sbilmis/parfor_demo.m
</pre>

<p>
and you are submitting from a local MATLAB session configured
with the TRUBA cluster profile, you do NOT change your local
working directory to /arf/scratch.
</p>

<p>
Instead, you specify the remote execution directory using
<code>CurrentFolder</code>.
</p>

<div class="org-src-container">
<pre class="src src-matlab">j = batch(c, @parfor_demo, 1, {}, ...
    'Pool', 55, ...
    'CurrentFolder', '/arf/scratch/sbilmis', ...
    'AutoAddClientPath', false);
</pre>
</div>

<p>
Explanation:
</p>

<ul class="org-ul">
<li><code>@parfor_demo</code> refers to the function name (parfor_demo.m).</li>
<li>The file must already exist in the specified remote directory.</li>
<li><code>CurrentFolder</code> tells TRUBA where to execute the job.</li>
<li><code>AutoAddClientPath = false</code> prevents MATLAB from trying to
stage local files to the cluster.</li>
<li><code>Pool = 55</code> results in 56 Slurm tasks (55 workers + 1 client).</li>
</ul>

<p>
In this mode, no file transfer occurs. MATLAB simply instructs
Slurm to execute the script directly from the shared TRUBA filesystem.
</p>
</div>
</div>



<div id="outline-container-org3ef7421" class="outline-4">
<h4 id="org3ef7421"><span class="section-number-4">10.2.5.</span> Retrieve Output</h4>
<div class="outline-text-4" id="text-10-2-5">
<div class="org-src-container">
<pre class="src src-matlab">wait(j);
diary(j)          % shows printed text (including elapsed time)
t = fetchOutputs(j);
delete(j);
</pre>
</div>

<p>
The following screenshot shows the Slurm submission arguments and the
measured execution time:
</p>


<div id="org1c29872" class="figure">
<p><img src="first.png" alt="first.png" width="900px" />
</p>
<p><span class="figure-number">Figure 9: </span>Slurm submission arguments and parfor execution time on orfoz (55 workers).</p>
</div>

<p>
This runtime confirms that 55 CPU cores were actively utilized instead of remaining idle.
</p>
</div>
</div>



<div id="outline-container-org3312d4d" class="outline-4">
<h4 id="org3312d4d"><span class="section-number-4">10.2.6.</span> Job Submission (File Already Exists on TRUBA)</h4>
<div class="outline-text-4" id="text-10-2-6">
<p>
If the script already exists on TRUBA (for example at:
</p>

<pre class="example" id="org87b683a">
/arf/scratch/sbilmis/parfor_demo.m
</pre>

<p>
and you are submitting from a local MATLAB session configured
with the TRUBA cluster profile, you do NOT change your local
working directory to /arf/scratch.
</p>

<p>
Instead, you specify the remote execution directory using
<code>CurrentFolder</code>.
</p>

<div class="org-src-container">
<pre class="src src-matlab">j = batch(c, @parfor_demo_on_arf, 1, {}, ...
    'Pool', 55, ...
    'CurrentFolder', '/arf/scratch/sbilmis', ...
    'AutoAddClientPath', false);
</pre>
</div>

<p>
Explanation:
</p>

<ul class="org-ul">
<li><code>@parfor_demo</code> refers to the function name (parfor_demo.m).</li>
<li>The file must already exist in the specified remote directory.</li>
<li><code>CurrentFolder</code> tells TRUBA where to execute the job.</li>
<li><code>AutoAddClientPath = false</code> prevents MATLAB from trying to
stage local files to the cluster.</li>
<li><code>Pool = 55</code> results in 56 Slurm tasks (55 workers + 1 client).</li>
</ul>

<p>
In this mode, no file transfer occurs. MATLAB simply instructs
Slurm to execute the script directly from the shared TRUBA filesystem.
</p>


<pre class="example" id="org7a8c5a5">
# Here is the output:
Submit arguments: --ntasks=56 --cpus-per-task=1 -D /arf/scratch/$USER --ntasks-per-core=1 -t 0-00:30 -N 1 -p orfoz
&gt;&gt; j.wait;
&gt;&gt; j.diary
--- Start Diary ---
parfor_demo: N=55, elapsed=1.85 s

--- End Diary ---
</pre>
</div>
</div>
</div>




<div id="outline-container-orgaadc2d9" class="outline-3">
<h3 id="orgaadc2d9"><span class="section-number-3">10.3.</span> Running Interactively on TRUBA with <code>parpool</code></h3>
<div class="outline-text-3" id="text-10-3">
<p>
In this method, you start a parallel pool interactively and then run the
same <code>parfor_demo</code> function as usual. The pool workers are started on TRUBA
compute nodes through Slurm.
</p>

<div class="org-src-container">
<pre class="src src-matlab">% Get a handle to the cluster profile
c = parcluster;

% Target the orfoz partition (56 cores per node policy)
c.AdditionalProperties.Partition = 'orfoz';
c.AdditionalProperties.NumNodes  = 1;
c.AdditionalProperties.WallTime  = '0-00:30';
</pre>
</div>
</div>

<div id="outline-container-org56db246" class="outline-4">
<h4 id="org56db246"><span class="section-number-4">10.3.1.</span> Set the client hostname (recommended)</h4>
<div class="outline-text-4" id="text-10-3-1">
<p>
Before creating the pool, set the client hostname. This helps MATLAB workers
connect back to your client process reliably (especially in environments with
multiple network interfaces).
</p>

<pre class="example">
sethostname
</pre>
</div>
</div>

<div id="outline-container-org20b03c2" class="outline-4">
<h4 id="org20b03c2"><span class="section-number-4">10.3.2.</span> Create the cluster pool</h4>
<div class="outline-text-4" id="text-10-3-2">
<p>
For a half-node job on <code>orfoz</code>, request a 56-task allocation and start a pool
with 56 workers.
</p>

<div class="org-src-container">
<pre class="src src-matlab">pool = parpool(c, 56)
</pre>
</div>

<p>
Show the screenshot here.
</p>


<div id="orga4c4873" class="figure">
<p><img src="2_a.png" alt="2_a.png" width="900px" />
</p>
<p><span class="figure-number">Figure 10: </span>Creating a cluster-backed parallel pool on orfoz.</p>
</div>

<p>
At this point, a Slurm job is submitted in the background and the pool becomes
available. After the pool is connected, you can run your code exactly as if you
were working in a regular MATLAB session.
</p>
</div>
</div>

<div id="outline-container-orgefb72a3" class="outline-4">
<h4 id="orgefb72a3"><span class="section-number-4">10.3.3.</span> Run the demo code</h4>
<div class="outline-text-4" id="text-10-3-3">
<div class="org-src-container">
<pre class="src src-matlab">parfor_demo
</pre>
</div>

<p>
Show the screenshot here.
</p>


<div id="org036a2b5" class="figure">
<p><img src="2_b.png" alt="2_b.png" width="900px" />
</p>
<p><span class="figure-number">Figure 11: </span>Running <code>parfor_demo</code> using the active cluster pool.</p>
</div>
</div>
</div>

<div id="outline-container-orgf35c48a" class="outline-4">
<h4 id="orgf35c48a"><span class="section-number-4">10.3.4.</span> Close the pool (release resources)</h4>
<div class="outline-text-4" id="text-10-3-4">
<p>
When you are finished, delete the pool to release the Slurm allocation and
compute resources.
</p>

<div class="org-src-container">
<pre class="src src-matlab">delete(pool)   % equivalent to: pool.delete
</pre>
</div>
</div>
</div>
</div>






<div id="outline-container-orga0cae25" class="outline-3">
<h3 id="orga0cae25"><span class="section-number-3">10.4.</span> Submitting via a Slurm Batch Script (Recommended HPC Method)</h3>
<div class="outline-text-3" id="text-10-4">
<p>
This method runs MATLAB entirely inside a Slurm allocation.
Slurm allocates the CPU resources, and MATLAB creates a local
parallel pool that uses those allocated cores.
</p>

<p>
This is the most robust and recommended approach for production workloads.
</p>
</div>

<div id="outline-container-org35348e6" class="outline-4">
<h4 id="org35348e6"><span class="section-number-4">10.4.1.</span> MATLAB Script (run_parfor.m)</h4>
<div class="outline-text-4" id="text-10-4-1">
<p>
Create the following file in your working directory:
</p>

<div class="org-src-container">
<pre class="src src-matlab">% run_parfor.m

% Read number of workers from environment variable
n = str2double(getenv("NUM_WORKERS"));

% Start a local parallel pool using allocated CPUs
parpool('local', n);

% Run the demo function
parfor_demo();

% Clean up the pool
delete(gcp('nocreate'));
</pre>
</div>

<p>
Explanation:
</p>

<ul class="org-ul">
<li><code>NUM_WORKERS</code> is passed from Slurm.</li>
<li><code>parpool('local', n)</code> starts workers using the CPUs already allocated.</li>
<li>No Slurm plugin or cluster profile is used.</li>
<li>The pool is deleted at the end to release resources cleanly.</li>
</ul>
</div>
</div>

<div id="outline-container-org258aea3" class="outline-4">
<h4 id="org258aea3"><span class="section-number-4">10.4.2.</span> Slurm Script (submit_parfor.sh)</h4>
<div class="outline-text-4" id="text-10-4-2">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">!/bin/</span><span style="color: #0000FF;">bash</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -J matlab-parfor</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -A sbilmis</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -p orfoz</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -N 1</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH --ntasks=56</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH --cpus-per-task=1</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -t 0-00:30</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -o matlab-parfor_%j.out</span>
<span style="color: #8D8D84;">#</span><span style="color: #A0A1A7; font-style: italic;">SBATCH -e matlab-parfor_%j.err</span>

module load apps/matlab/r2025b

<span style="color: #8D8D84;"># </span><span style="color: #A0A1A7; font-style: italic;">Use one task for MATLAB client, remaining for workers</span>
<span style="color: #006FE0;">export</span> <span style="color: #BA36A5;">NUM_WORKERS</span>=$(<span style="color: #FF1493;">(SLURM_NTASKS - 1</span>))

matlab -batch <span style="color: #008000;">"run('run_parfor.m')"</span>
</pre>
</div>

<p>
Key points:
</p>

<ul class="org-ul">
<li><code>--ntasks=56</code> reserves 56 CPU cores on <code>orfoz</code>.</li>
<li>One core runs the main MATLAB process.</li>
<li>55 cores are used as parallel workers.</li>
<li><code>NUM_WORKERS</code> is computed automatically from <code>SLURM_NTASKS</code>.</li>
<li>If <code>--ntasks</code> changes, worker count adjusts automatically.</li>
</ul>
</div>
</div>

<div id="outline-container-org0c36d59" class="outline-4">
<h4 id="org0c36d59"><span class="section-number-4">10.4.3.</span> Submitting the Job</h4>
<div class="outline-text-4" id="text-10-4-3">
<div class="org-src-container">
<pre class="src src-bash">sbatch submit_parfor.sh
</pre>
</div>

<p>
Monitor job status:
</p>

<div class="org-src-container">
<pre class="src src-bash">squeue -u sbilmis
</pre>
</div>
</div>
</div>

<div id="outline-container-org3065025" class="outline-4">
<h4 id="org3065025"><span class="section-number-4">10.4.4.</span> Output File</h4>
<div class="outline-text-4" id="text-10-4-4">
<p>
After completion, inspect:
</p>

<div class="org-src-container">
<pre class="src src-bash">cat matlab-parfor_&lt;jobid&gt;.out
</pre>
</div>

<p>
Example output:
</p>

<pre class="example" id="orga5151a4">

	Sponsored License -- for use in support of a program or activity sponsored by MathWorks.
	Not for government, commercial or other non-sponsored organizational use.

Starting parallel pool (parpool) using the 'Processes' profile ...
Connected to parallel pool with 55 workers.
parfor_demo: N=55, elapsed=1.29 s
Parallel pool using the 'Processes' profile is shutting down.
</pre>
</div>
</div>
</div>








<div id="outline-container-orga99d75d" class="outline-3">
<h3 id="orga99d75d"><span class="section-number-3">10.5.</span> Running MATLAB via Open OnDemand (Interactive Desktop)</h3>
<div class="outline-text-3" id="text-10-5">
<p>
Open OnDemand allows users to launch a graphical desktop session
on TRUBA compute nodes through a web browser. This is equivalent
to running an interactive Slurm job.
</p>

<p>
In this mode, Slurm allocates the resources first, and MATLAB runs
inside that allocation.
</p>

<p>
&#x2014;
</p>
</div>

<div id="outline-container-orgb8fddc0" class="outline-4">
<h4 id="orgb8fddc0"><span class="section-number-4">10.5.1.</span> Step 1: Launch Desktop Session</h4>
<div class="outline-text-4" id="text-10-5-1">
<ol class="org-ol">
<li>Log in to Open OnDemand.</li>
<li>Select <b>Interactive Apps → Desktop</b>.</li>
<li>Choose the following parameters:

<ul class="org-ul">
<li>Desktop Environment: xfce</li>
<li>Partition: orfoz</li>
<li>Time limit: 1 hour</li>
<li>Account: sbilmis</li>
</ul></li>

<li>Click <b>Launch</b>.</li>
</ol>


<div id="orgbe4f2a5" class="figure">
<p><img src="images/ood_desktop_launch.png" alt="ood_desktop_launch.png" width="900px" />
</p>
<p><span class="figure-number">Figure 12: </span>Open OnDemand Desktop launch configuration (orfoz partition).</p>
</div>

<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-orge7ed6da" class="outline-4">
<h4 id="orge7ed6da"><span class="section-number-4">10.5.2.</span> Step 2: Open Terminal</h4>
<div class="outline-text-4" id="text-10-5-2">
<p>
Once the desktop loads:
</p>

<ol class="org-ol">
<li>Right-click on the desktop</li>
<li>Select <b>Open Terminal Here</b></li>
</ol>


<div id="org3666b8a" class="figure">
<p><img src="images/ood_open_terminal.png" alt="ood_open_terminal.png" width="700px" />
</p>
<p><span class="figure-number">Figure 13: </span>Opening a terminal inside the interactive desktop session.</p>
</div>

<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-org6149c54" class="outline-4">
<h4 id="org6149c54"><span class="section-number-4">10.5.3.</span> Step 3: Load MATLAB Module</h4>
<div class="outline-text-4" id="text-10-5-3">
<p>
In the terminal:
</p>

<div class="org-src-container">
<pre class="src src-bash">module purge
module load apps/matlab/r2025b
matlab
</pre>
</div>


<div id="orge219b8e" class="figure">
<p><img src="images/ood_terminal_module.png" alt="ood_terminal_module.png" width="900px" />
</p>
<p><span class="figure-number">Figure 14: </span>Loading MATLAB module inside Open OnDemand desktop.</p>
</div>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-orgadd8c84" class="outline-4">
<h4 id="orgadd8c84"><span class="section-number-4">10.5.4.</span> Step 4: Submit Job Using batch()</h4>
<div class="outline-text-4" id="text-10-5-4">
<p>
Instead of running <code>parpool</code> interactively, we submit the job
using the TRUBA cluster profile. This allows the job to continue
running even after MATLAB is closed.
</p>

<p>
Inside the MATLAB command window:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;

c.AdditionalProperties.Partition = 'orfoz';
c.AdditionalProperties.NumNodes  = 1;
c.AdditionalProperties.WallTime  = '0-00:30';

j = batch(c, @parfor_demo, 1, {}, ...
    'Pool', 55, ...
    'CurrentFolder', '/arf/scratch/sbilmis', ...
    'AutoAddClientPath', false);

# or one line
j = batch(c, @parfor_demo, 1, {}, 'Pool', 55, 'CurrentFolder', '/arf/scratch/sbilmis', 'AutoAddClientPath', false);

</pre>
</div>


<p>
Explanation:
</p>

<ul class="org-ul">
<li><code>Pool = 55</code> results in 56 Slurm tasks (55 workers + 1 client).</li>
<li><code>CurrentFolder</code> specifies where the function exists on TRUBA.</li>
<li>The job is now managed entirely by Slurm.</li>
<li>You may safely close MATLAB after submission.</li>
</ul>


<div id="orgd37ac97" class="figure">
<p><img src="ood_batch_submit.png" alt="ood_batch_submit.png" width="900px" />
</p>
<p><span class="figure-number">Figure 15: </span>Submitting parfor_demo using batch() inside Open OnDemand.</p>
</div>

<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-org9bf1f2b" class="outline-4">
<h4 id="org9bf1f2b"><span class="section-number-4">10.5.5.</span> Step 5: Close MATLAB (Optional)</h4>
<div class="outline-text-4" id="text-10-5-5">
<p>
After submission, you may close MATLAB and even close
the Open OnDemand desktop session.
</p>

<p>
The job continues running on TRUBA.
</p>

<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-orge9fc87f" class="outline-4">
<h4 id="orge9fc87f"><span class="section-number-4">10.5.6.</span> Step 6: Monitor Job from Terminal</h4>
<div class="outline-text-4" id="text-10-5-6">
<p>
From any login node:
</p>

<div class="org-src-container">
<pre class="src src-bash">squeue -u sbilmis
</pre>
</div>

<p>
To check detailed job information:
</p>

<div class="org-src-container">
<pre class="src src-bash">scontrol show job &lt;jobid&gt;
</pre>
</div>



<div id="org8e05150" class="figure">
<p><img src="ood_squeue.png" alt="ood_squeue.png" width="900px" />
</p>
<p><span class="figure-number">Figure 16: </span>Monitoring submitted MATLAB job via squeue.</p>
</div>


<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-orgc5df7a1" class="outline-4">
<h4 id="orgc5df7a1"><span class="section-number-4">10.5.7.</span> Step 7: Retrieve Output Without MATLAB</h4>
<div class="outline-text-4" id="text-10-5-7">
<p>
Cluster profile jobs store results under:
</p>

<pre class="example" id="org5825ff0">
/arf/home/sbilmis/.matlab/generic_cluster_jobs/truba/
</pre>

<p>
List jobs:
</p>

<div class="org-src-container">
<pre class="src src-bash">ls /arf/home/sbilmis/.matlab/generic_cluster_jobs/truba/
</pre>
</div>

<p>
Each job has a folder:
</p>

<pre class="example" id="org3e15f84">
Job1/
Job2/
Job3/
</pre>

<p>
To read printed output (diary):
</p>

<div class="org-src-container">
<pre class="src src-bash">cat /arf/home/sbilmis/.matlab/generic_cluster_jobs/truba/JobX/diary
</pre>
</div>

<p>
Example output:
</p>

<pre class="example" id="orgf7a12ad">
parfor_demo: N=55, elapsed=1.83 s
</pre>

<pre class="example" id="orgda26e6c">
📘 sbilmis@arf-ui1  ~$ grep "parfor_demo:" ~/.matlab/generic_cluster_jobs/truba/Job3/Task*.diary.txt
/arf/home/sbilmis/.matlab/generic_cluster_jobs/truba/Job3/Task1.diary.txt:parfor_demo: N=55, elapsed=1.89 s
</pre>


<p>
&#x2014;
</p>
</div>
</div>

<div id="outline-container-org00c92be" class="outline-4">
<h4 id="org00c92be"><span class="section-number-4">10.5.8.</span> Step 8: (Optional) Retrieve Output Later in MATLAB</h4>
<div class="outline-text-4" id="text-10-5-8">
<p>
If you reopen MATLAB later, you can recover the job object:
</p>

<div class="org-src-container">
<pre class="src src-matlab">c = parcluster;
jobs = c.Jobs;
j = jobs(end);
t = fetchOutputs(j);
</pre>
</div>

<p>
This allows retrieval of returned variables without rerunning the job.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org8eb49a6" class="outline-2">
<h2 id="org8eb49a6"><span class="section-number-2">11.</span> Further Reading</h2>
<div class="outline-text-2" id="text-11">
<p>
To learn more about MATLAB Parallel Computing Toolbox,
the following official MathWorks resources may be helpful:
</p>

<ul class="org-ul">
<li><a href="https://www.mathworks.com/products/parallel-computing/index.html">Parallel Computing Overview</a></li>
<li><a href="https://www.mathworks.com/help/parallel-computing/">Parallel Computing Documentation</a></li>
<li><a href="https://www.mathworks.com/help/parallel-computing/examples.html">Parallel Computing Coding Examples</a></li>
<li><a href="https://www.mathworks.com/products/parallel-computing/tutorials.html">Parallel Computing Tutorials</a></li>
<li><a href="https://www.mathworks.com/products/parallel-computing/videos.html">Parallel Computing Videos</a></li>
<li><a href="https://www.mathworks.com/products/parallel-computing/webinars.html">Parallel Computing Webinars</a></li>
</ul>

<p>
These resources cover general usage of parallel computing within MATLAB and are not specific to TRUBA cluster configuration.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: sbilmis</p>
<p class="date">Created: 2026-02-24 Tue 17:26</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
